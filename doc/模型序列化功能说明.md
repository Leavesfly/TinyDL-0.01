# TinyDL 模型序列化功能

本项目为TinyDL深度学习框架实现了完整的模型序列化功能，支持模型的保存、加载和管理。

## 🚀 主要功能

### 1. 核心数据结构序列化支持
- ✅ **NdArray** - 添加了`Serializable`接口，支持N维数组的序列化
- ✅ **Shape** - 支持数组形状信息的序列化  
- ✅ **Variable** - 支持变量的序列化（creator字段标记为transient避免循环引用）
- ✅ **Parameter** - 继承Variable的序列化能力

### 2. 完整的模型序列化系统

#### ModelSerializer类
提供了丰富的模型序列化功能：
- 📁 **完整模型保存/加载** - 包含架构和参数
- 🗜️ **压缩保存** - 支持GZIP压缩减少文件大小
- ⚙️ **仅参数保存/加载** - 灵活的参数管理
- 🔄 **检查点功能** - 训练过程中的状态保存
- ✅ **模型验证** - 验证模型文件完整性
- 🔍 **参数比较** - 比较两个模型的参数

#### ModelInfo类
完整的模型元数据管理：
- 📝 **基本信息** - 模型名称、版本、描述等
- 🏗️ **架构信息** - 网络结构、层数、参数统计
- 📊 **训练信息** - 训练轮次、损失、优化器配置
- 📈 **性能指标** - 准确率、精度、召回率等
- 🔧 **自定义属性** - 灵活的扩展属性

### 3. 参数管理系统

#### ParameterManager类
专门的参数操作工具：
- 💾 **参数保存/加载** - 独立的参数文件管理
- 📋 **参数复制** - 在模型间复制参数
- 🔍 **参数比较** - 精确比较模型参数
- 📊 **参数统计** - 获取参数的统计信息
- 🔄 **深拷贝** - 创建参数的完整副本
- 🎯 **参数筛选** - 根据名称模式筛选参数

### 4. JSON导出支持

#### ModelInfoExporter类
多种格式的信息导出：
- 📄 **完整JSON导出** - 包含所有模型信息
- 📄 **简化JSON导出** - 仅包含关键信息
- 📊 **简单报告** - 模型的概览信息
- 🔍 **比较报告** - 两个模型的对比分析

### 5. 扩展的Model类
增强的模型功能：
- 💾 **新保存方法** - `saveModel()`, `saveModelCompressed()`, `saveParameters()`
- 📁 **新加载方法** - `loadModel()`, `loadParameters()`, `resumeFromCheckpoint()`
- 📊 **训练信息更新** - `updateTrainingInfo()`, `addMetric()`
- 📝 **模型信息管理** - `printModelInfo()`, `getModelSummary()`

## 💡 使用示例

### 基本模型保存和加载
```java
// 创建模型
Model model = new Model("MyModel", mlpBlock);

// 保存完整模型
model.saveModel("models/my_model.model");

// 保存压缩模型
model.saveModelCompressed("models/my_model_compressed.model");

// 加载模型
Model loadedModel = Model.loadModel("models/my_model.model");
```

### 参数管理
```java
// 仅保存参数
model.saveParameters("models/parameters.params");

// 创建新模型并加载参数
Model newModel = createNewModel();
newModel.loadParameters("models/parameters.params");

// 比较两个模型的参数
boolean areEqual = ParameterManager.compareParameters(model1, model2);
```

### 训练检查点
```java
// 保存训练检查点
model.saveCheckpoint("checkpoints/epoch_100.ckpt", 100, 0.025);

// 从检查点恢复
Model restoredModel = Model.resumeFromCheckpoint("checkpoints/epoch_100.ckpt");
```

### 模型信息管理
```java
// 设置模型信息
model.setDescription("这是一个图像分类模型");
model.updateTrainingInfo(100, 0.025, "Adam", 0.001);
model.addMetric("accuracy", 0.95);

// 打印模型信息
model.printModelInfo();

// 导出JSON报告
ModelInfoExporter.exportToJson(model, "reports/model_info.json");
```

## 🧪 测试和验证

项目包含完整的测试代码：

### 示例程序
- 📄 `ModelSerializationExample.java` - 完整的功能演示
- 🧪 `ModelSerializationTest.java` - 单元测试验证

### 测试覆盖
- ✅ 基本序列化功能
- ✅ 参数序列化和加载
- ✅ 模型信息序列化
- ✅ 检查点功能
- ✅ 参数比较和复制
- ✅ JSON导出功能

## 📁 文件结构

新增文件：
```
src/main/java/io/leavesfly/tinydl/mlearning/
├── ModelSerializer.java      # 核心序列化器
├── ModelInfo.java           # 模型元数据
├── ParameterManager.java    # 参数管理器
└── ModelInfoExporter.java   # JSON导出器

src/main/java/io/leavesfly/tinydl/example/
└── ModelSerializationExample.java  # 使用示例

src/test/java/io/leavesfly/tinydl/test/
└── ModelSerializationTest.java     # 单元测试
```

修改文件：
```
src/main/java/io/leavesfly/tinydl/
├── ndarr/
│   ├── NdArray.java      # 添加Serializable
│   └── Shape.java        # 添加Serializable
├── func/
│   └── Variable.java     # 添加Serializable，creator标记transient
└── mlearning/
    └── Model.java        # 扩展保存/加载方法
```

## 🎯 主要特性

1. **向后兼容** - 保持原有API的同时添加新功能
2. **类型安全** - 完整的类型检查和验证
3. **内存优化** - 避免循环引用，支持压缩存储
4. **灵活性** - 支持多种保存格式和部分加载
5. **可观测性** - 丰富的模型信息和统计数据
6. **易用性** - 简洁的API设计，详细的文档

## 🛡️ 安全性

- 序列化版本控制（serialVersionUID）
- 循环引用避免（transient关键字）
- 参数形状验证
- 文件存在性检查
- 异常处理和错误信息

这个完整的序列化系统为TinyDL框架提供了企业级的模型管理能力，支持复杂的训练流程和模型部署需求。